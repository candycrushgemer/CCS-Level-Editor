<html>
    <!-- Download stuff -->
    <head>
        <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Level Editor</title>
        <link rel="icon" href="logo.png">
        <link href="style.css" rel="stylesheet" type="text/css" />
        <link href="ui-fluent.css" rel="stylesheet" type="text/css" />
        <link href="fonts.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="ccgemer-home-stylesheet.css">
        <script src="https://cdn.jsdelivr.net/npm/underscore@1.12.0/underscore-min.js"></script>
        
        <!-- Firebase Imports -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
            import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
            import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBEbBryhcs9qxHpi9oxCiW9jV5eTDZHP7M",
                authDomain: "ccs-level-editor.firebaseapp.com",
                projectId: "ccs-level-editor",
                storageBucket: "ccs-level-editor.firebasestorage.app",
                messagingSenderId: "10424890215",
                appId: "1:10424890215:web:e7bfc73e36785ef439f5c2"
            };

            // Initialize Firebase
            window.app = initializeApp(firebaseConfig);
            window.auth = getAuth(window.app);
            window.db = getFirestore(window.app);

            // Function to fetch and display user data
            async function fetchUserData() {
                try {
                    const user = window.auth.currentUser;
                    
                    if (user) {
                        const userRef = doc(window.db, "users", user.uid);
                        const userDoc = await getDoc(userRef);
                        
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            
                            // Update username display
                            const username = userData.username || "User";
                            const usernameElement = document.getElementById("username");
                            const usernameBigHeader = document.querySelector(".username-big-header span");
                            if (usernameElement) {
                                usernameElement.textContent = username;
                            }
                            if (usernameBigHeader) {
                                usernameBigHeader.textContent = username;
                            }
                            
                            // Update points display
                            const powerUsesElement = document.getElementById('powerUses');
                            if (powerUsesElement) {
                                powerUsesElement.textContent = userData.points || 0;
                            }
                            
                            // Update streak display
                            const streaksElement = document.getElementById('streaks');
                            if (streaksElement) {
                                streaksElement.textContent = userData.streak || 0;
                            }

                            // Update avatar display
                            const avatar = document.querySelector('fluent-avatar');
                            if (avatar) {
                                if (userData.avatarURL) {
                                    avatar.style.setProperty('--avatar', `url(${userData.avatarURL})`);
                                } else {
                                    // Set default avatar if none exists
                                    avatar.style.setProperty('--avatar', 'url(avatar-generic.png)');
                                }
                            }

                            // Update email display
                            const emailElement = document.getElementById('email');
                            if (emailElement) {
                                emailElement.textContent = userData.email || user.email || 'No email set';
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error fetching user data:', error);
                }
            }

            // Listen for authentication state changes
            onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    // User is signed in
                    console.log("User is signed in:", user.uid);
                    fetchUserData();
                } else {
                    // User is signed out
                    console.log("User is signed out");
                    // Redirect to login page
                    window.location.href = "login.html";
                }
            });

            // Add event listener for avatar change button
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('changeAvatar').addEventListener('click', function() {
                    if (typeof window.handleAvatarChange === 'function') {
                        window.handleAvatarChange();
                    } else {
                        console.error('handleAvatarChange function is not available');
                    }
                });
            });
        </script>
        
        <meta content="Web Candy Crush Level Editor" property="og:title">
        <meta content="Level editor for candy crush that can be used to export levels in your browser" property="og:description">
        <meta content="Candy Crush Level Editor" property="og:site_name">
        <version>1.9</version>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <link rel="stylesheet" href="https://unpkg.com/mdui@2/mdui.css">
        <script src="https://unpkg.com/mdui@2/mdui.global.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
        <script type="importmap">
            {
                "imports": {
                    "@material/web/": "https://esm.run/@material/web/"
                }
            }
        </script>
        <script type="module">
            import '@material/web/all.js';
            import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

            document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
        </script>
        
        <script id="mduiAccent">
            document.addEventListener('DOMContentLoaded', () => {
                // Ensure mdui is available before calling setColorScheme
                if (typeof mdui !== 'undefined') {
                    mdui.setColorScheme('#7ac8ef');
                } else {
                    console.error('MDUI is not loaded.');
                }
            });
        </script>
        <!-- Add GSAP -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
        <!-- Filled -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!-- Outlined -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
        <!-- Rounded -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
        <!-- Sharp -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
        <!-- Two Tone -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Two+Tone" rel="stylesheet">
        <link id="mwcaccent" rel="stylesheet" href="/mat-accent-color-light.css">
        <script type="module" src="https://cdn.forge.tylertech.com/v1/libs/@tylertech/forge@3.4.0/index.js"></script>
        <!-- Add Cropper.js CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" integrity="sha512-cyzxRvewl+FOKTtpBzYjW6x6IAYUCZy3sGP40hn+DQkqeluGRCax7qztK2ImL64SA+C7kVWdLI6wvdlStawhyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <!-- Add Cropper.js JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js" integrity="sha512-6lplKUSl86rUVprDIjiW8DuOniNX8UDoRATqZSds/7t6zCQZfaCe3e5zcGaQwxa8Kpn5RTM9Fvl3X2lLV4grPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <!-- Load credentials.js first -->
        <script type="module" src="credentials.js"></script>
        <script>
            // Function to detect if the user is on a mobile device
            function isMobileDevice() {
                return /Mobi|Android/i.test(navigator.userAgent);
            }
        
            // Function to detect if the user is on a tablet or desktop
            function isTabletOrDesktop() {
                return !isMobileDevice() || (window.innerWidth >= 768); // Assuming tablets have a width of 768px or more
            }
        
            // Redirect logic
            window.onload = function() {
                const currentPath = window.location.pathname;
        
                console.log("Current Path:", currentPath);
                console.log("Is Mobile Device:", isMobileDevice());
                console.log("Is Tablet or Desktop:", isTabletOrDesktop());
        
                if (isMobileDevice() && currentPath.endsWith('editor.html')) {
                    // If on mobile and currently on editor.html, redirect to index-mobile.html
                    console.log("Redirecting to index-mobile.html");
                    window.location.href = 'index-mobile.html';
                } else if (isTabletOrDesktop() && currentPath.endsWith('index-mobile.html')) {
                    // If on tablet/desktop and currently on index-mobile.html, redirect to editor.html
                    console.log("Redirecting to editor.html");
                    window.location.href = 'editor.html';
                }
            };
        </script>
        <script src="
        https://cdn.jsdelivr.net/npm/ace-builds@1.38.0/src-noconflict/snippets/python.min.js
        "></script>
        <link href="
        https://cdn.jsdelivr.net/npm/ace-builds@1.38.0/css/ace.min.css
        " rel="stylesheet">        
    </head>

    <body style="margin: 0;">
        <div class="overlay-loading" style="background-color: #ffffffb9; backdrop-filter: blur(50px);">
            <loading-block size="card-large" style="height: 70%;"></loading-block>
        </div>
        <script>
            window.onload = function() {
                document.body.classList.add('fade-in'); // Add the fade-in class
                const loadingOverlay = document.querySelector('.overlay-loading'); // Select the loading overlay
                
                // Set a timeout to hide the loading overlay after 1 second
                setTimeout(() => {
                    loadingOverlay.style.display = 'none'; // Hide the loading overlay
                }, 1000); // 1000 milliseconds = 1 second
            };
        </script>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
            import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
            import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            // Function to fetch and display the user's username
            async function fetchUserUsername() {
                const user = auth.currentUser;
                
                if (user) {
                    console.log("User is logged in:", user.uid);
                    
                    try {
                        // Get user data from Firestore
                        const userRef = doc(db, "users", user.uid);
                        const userDoc = await getDoc(userRef);
                        
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            const username = userData.username || "User";
                            
                            // Update the username display
                            const usernameElement = document.getElementById("username");
                            const usernameBigHeader = document.querySelector(".username-big-header span");
                            if (usernameElement) {
                                usernameElement.textContent = username;
                            }
                            if (usernameBigHeader) {
                                usernameBigHeader.textContent = username;
                            }
                            
                            console.log("Username fetched successfully:", username);
                        } else {
                            console.log("No user document found in Firestore");
                        }
                    } catch (error) {
                        console.error("Error fetching user data:", error);
                    }
                } else {
                    console.log("No user is currently logged in");
                    // Redirect to login page if not logged in
                    window.location.href = "login.html";
                }
            }

            // Listen for authentication state changes
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in
                    console.log("User is signed in:", user.uid);
                    fetchUserUsername();
                } else {
                    // User is signed out
                    console.log("User is signed out");
                    // Redirect to login page
                    window.location.href = "login.html";
                }
            });
        </script>
        <script src="script.js" defer></script>
          
            <mdui-layout-main class="example-layout-main" style="height: 100vh; display: flex; align-items: center; justify-content: center;  background: linear-gradient(339deg,rgba(207, 212, 255, 1) 0%, rgba(255, 255, 255, 1) 100%); position: absolute; top:0; width: 100%;">
                <!--<div class="center">
                    <div class="card"><img src="logo-horizontal.png" width="90px" draggable="false" style="margin-left: 10px; margin-top: 10px;">
                        <h1>Manage your account</h1>
                        <md-list-item style="width: 99%; background-color: #ffffff50; border-top-left-radius: 20px; border-top-right-radius: 20px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; padding: 5px;">
                            <img src="account_circle--sf-symbools.svg" slot="start" width="26px" draggable="false">
                            <span id="username">Username</span>
                        </md-list-item>
                        <md-list-item clickable id="changeUsername" style="width: 100%; border-radius: 5px; background-color: #ffffff50; margin-top: 3px;">
                            Change username
                            <span class="sf-icon" slot="end"></span>
                        </md-list-item>
                        <md-list-item clickable id="changePass" style="width: 100%; border-radius: 5px; background-color: #ffffff50; margin-top: 3px;">
                            Change password
                            <span class="sf-icon" slot="end"></span>
                        </md-list-item>
                        <md-list-item clickable id="billing" onclick="window.location.href = 'pricing.html'" style="width: 100%; border-radius: 5px; background-color: #ffffff50; margin-top: 3px;">
                            Billing
                            <span class="sf-icon" slot="end"></span>
                        </md-list-item>
                        <md-list-item clickable onclick="window.location.href = 'pricing.html'" id="powerManager" style="width: 100%; border-bottom-right-radius: 20px; border-top-right-radius: 5px; border-top-left-radius: 5px; border-bottom-left-radius: 20px; background-color: #ffffff50; margin-top: 3px;">
                            Manage Powers
                            <span class="sf-icon" slot="end"></span>
                        </md-list-item>
                        <md-list-item clickable style="width: 100%; border-bottom-right-radius: 20px; border-top-right-radius: 5px; border-top-left-radius: 5px; border-bottom-left-radius: 20px; background-color: #ffffff00; margin-top: 3px; height: 50px;">
                            <span style="font-size: smaller; ">DANGEROUS ZONE</span>
                        </md-list-item>
                        <md-list-item clickable id="delete-account-btn" style="width: 100%; border-radius: 20px; background-color: #ffffff50; margin-top: 3px; --md-list-item-label-text-color: var(--md-sys-color-error);">
                            Delete account
                        </md-list-item>
                        <br>
                        <md-list-item clickable id="logout-btn" style="width: 100%; border-radius: 20px; background-color: #ffffff50; margin-top: 3px; --md-list-item-label-text-color: var(--md-sys-color-error);">
                            Sign out
                        </md-list-item>
                        <br>
                    </div>
                    <br>
                    <div class="hrefs" style="display: flex; gap: 20px;">
                        <a href="javascript:void(0)" class="footer-href">Legal</a>
                        <a href="javascript:void(0)" class="footer-href">Terms of Services</a>
                        <a href="javascript:void(0)" class="footer-href" id="creditsBtn">Credits</a>
                        <a href="javascript:void(0)" class="footer-href" style="pointer-events: none; opacity: 0.5;">Version 1.9</a>
                    </div>
                    <br>
                </div>-->
                <top-app-bar>
                    <ul style="display: flex; align-items: center; gap: 10px; position: relative;">
                      <li id="ccgappsLogo" style="font-weight: 800; display: flex; align-items: center; gap: 1px; position: relative;">
                        <img src="/LevelEditorWeb/CCGAppsGifLogo.gif" alt="CCGApps" style="width: 20px; height: 20px; border-radius: 50%; transform: scale(1.8); opacity: 0; position: absolute; left: 10px;"> 
                        <span class="ccgapps-text" style="margin-left: 5px;">CCGApps</span>
                      </li>
                      <span>Account Center</span>
                    </ul>
                    <ul class="top-app-bar-btns">
                      <li onclick="window.location.href = '../level-editor/'">Home</li>
                    </ul>
                </top-app-bar>
                <main style="width: 70%;">
                    <account-settings>
                        <account-settings-panel>
                            <list-item tabindex="0" onclick="
                                const infoPage = document.querySelector('details-page[page=\'information\']');
                                const securityPage = document.querySelector('details-page[page=\'security\']');
                                const billingPage = document.querySelector('details-page[page=\'billing\']');

                                infoPage.style.display = 'block';
                                securityPage.style.display = 'none';
                                billingPage.style.display = 'none';
                                ">
                                <sf-icon>9</sf-icon>Your information
                            </list-item>
                            <list-item tabindex="0" onclick="
                            const infoPage = document.querySelector('details-page[page=\'information\']');
                            const securityPage = document.querySelector('details-page[page=\'security\']');
                            const billingPage = document.querySelector('details-page[page=\'billing\']');

                            infoPage.style.display = 'none';
                            securityPage.style.display = 'block';
                            billingPage.style.display = 'none';
                            ">
                                <sf-icon></sf-icon>Security
                            </list-item>
                            <list-item tabindex="0" onclick="
                            const infoPage = document.querySelector('details-page[page=\'information\']');
                            const securityPage = document.querySelector('details-page[page=\'security\']');
                            const billingPage = document.querySelector('details-page[page=\'billing\']');

                                infoPage.style.display = 'none';
                                securityPage.style.display = 'none';
                                billingPage.style.display = 'block';
                            ">
                                <sf-icon>朗</sf-icon>Billing
                            </list-item>
                        </account-settings-panel>
                        <account-settings-details>
                            <details-page page="information" >
                                <h1>Your Information</h1>
                                <div class="avatar-manager">
                                    <fluent-avatar style="--avatar: url(avatar-generic.png);"></fluent-avatar>
                                    
                                    <div class="data"> 
                                        <h1 class="username-big-header">@<span></span></h1>
                                        <div class="streaks-powers">
                                            <div class="powers"><img src="power_uses.png" alt=""> <span id="powerUses"></span></div>
                                            <div class="streaks">
                                                <img src="streaks-ico.png" alt="">
                                                <span id="streaks"></span>
                                            </div>
                                        </div>
                                        <button class="filled-button" style="margin-top: 10px;" id="changeAvatar">Change avatar</button>
                                    </div>
                                </div>
                                <list-item-wrapper collapse>
                                    <list-item tabindex="0" header onclick="
                                        const wrapper = this.parentElement;
                                        if (wrapper.hasAttribute('active')) {
                                            wrapper.removeAttribute('active');
                                        } else {
                                            wrapper.setAttribute('active', '');
                                        }
                                    ">
                                        <div class="start">
                                            <sf-icon></sf-icon><div>
                                                Username
                                                <span class="supporting-text" id="username">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="end">
                                            <sf-icon></sf-icon>
                                        </div>
                                    </list-item>
                                    <list-item style="--height: 100px;">
                                        <list-item-contents>
                                            <p>Change your username</p>
                                            <form action="" id="change-username-form">
                                                <text-input>
                                                    <sf-icon></sf-icon>
                                                    <input type="text" id="new-username" placeholder="username" name="username" required placeholder="Username">
                                                    <button class="icon-button"></button>
                                                </text-input>
                                            </form>
                                        </list-item-contents>
                                    </list-item>
                                </list-item-wrapper>
                                <list-item-wrapper collapse style="
                                margin-top: 80px !important;">
                                    <list-item header tabindex="0" onclick="
                                        const ewrapper = this.parentElement;
                                        if (ewrapper.hasAttribute('active')) {
                                            ewrapper.removeAttribute('active');
                                        } else {
                                            ewrapper.setAttribute('active', '');
                                        }
                                    ">
                                        <div class="start">
                                            <sf-icon>掠</sf-icon><div>
                                                Email 
                                                <span class="supporting-text" id="email">a@a.com</span>
                                            </div>
                                        </div>
                                    </list-item>
                                </list-item-wrapper>
                            </details-page>
                            <details-page page="security" style="display: none;">
                                <h1>Security</h1>
                                <list-item-wrapper collapse>
                                    <list-item tabindex="0" header onclick="
                                        const pwwrapper = this.parentElement;
                                        if (pwwrapper.hasAttribute('active')) {
                                            pwwrapper.removeAttribute('active');
                                        } else {
                                            pwwrapper.setAttribute('active', '');
                                        }
                                    ">
                                        <div class="start">
                                            <sf-icon></sf-icon><div>
                                                Password
                                            </div>
                                        </div>
                                        <div class="end">
                                            <sf-icon></sf-icon>
                                        </div>
                                    </list-item>
                                    <list-item style="--height: 100px;">
                                        <list-item-contents>
                                            <p>Change your password</p>
                                            <form id="change-password-form">
                                                <text-input>
                                                    <sf-icon></sf-icon>
                                                    <input type="password" placeholder="New password" id="new-password" name="password" required minlength="6">
                                                    <button class="icon-button"></button>
                                                </text-input>
                                            </form>
                                        </list-item-contents>
                                    </list-item>
                                </list-item-wrapper>
                                <list-item-wrapper collapse style="margin-top: 70px !important; color: var(--md-sys-color-error);">
                                    <list-item tabindex="0" header id="logout-btn">
                                        <div class="start">
                                            <sf-icon>Ǵ</sf-icon><div>
                                                Log out
                                            </div>
                                        </div>
                                        <div class="end">
                                            <sf-icon></sf-icon>
                                        </div>
                                    </list-item>
                                </list-item-wrapper>
                                <list-item-wrapper collapse style="margin-top: 70px !important; color: var(--md-sys-color-error);">
                                    <list-item tabindex="0" header id="delete-account-btn">
                                        <div class="start">
                                            <sf-icon>Z</sf-icon><div>
                                                Delete account
                                            </div>
                                        </div>
                                        <div class="end">
                                            <sf-icon></sf-icon>
                                        </div>
                                    </list-item>
                                </list-item-wrapper>
                            </details-page>
                            <details-page page="billing" style="display: none;">
                                <h1>Billing</h1>
                                Go to <a href="pricing.html">pricing page</a> for more info.
                            </details-page>
                        </account-settings-details>

                        <!--Mobile view-->
                        <account-nav-bar>
                            <div class="nav-bar-item">
                                <div class="nav-bar-icon"><sf-icon>b</sf-icon></div>
                                <span>Your information</span>
                            </div>
                            <div class="nav-bar-item">
                                <div class="nav-bar-icon"><sf-icon></sf-icon></div>
                                <span>Security</span>
                            </div>
                            <div class="nav-bar-item">
                                <div class="nav-bar-icon"><sf-icon>朗</sf-icon></div>
                                <span>Billing</span>
                            </div>
                        </account-nav-bar>
                    </account-settings>
                    <img src="ui/ccgapps_Account_Center_Altas.png" class="bgAccountCenter">
                </main>
                <!--Billing-->


                <forge-dialog class="settings-fulldialog" style="--forge-dialog-shape: 30px; --forge-dialog-background: var(--md-sys-color-surface-container-high); width: 90vh;">
                    <forge-scaffold style="margin: 0; width: 700px; height: 700px;">
                        <mdui-layout slot="body">
                            <mdui-top-app-bar style="background-color: #00000000;">
                                <button class="icon-button close-settings"></button>
                                <mdui-top-app-bar-title><strong>Settings</strong></mdui-top-app-bar-title>
                                <div style="flex-grow: 1"></div>
                            </mdui-top-app-bar>
                            <mdui-layout-main>
                                <md-list style="margin: 20px; margin-top: 0; display: flex; flex-direction: column; background-color: #00000000; gap: 3px;">
                                    <md-list-item style="background-color: var(--md-sys-color-background); border-top-left-radius: 20px; border-top-right-radius: 20px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px;">
                                        Enable dark mode
                                        <forge-switch id="switchDark" icon="none" slot="end" style="--forge-switch-track-on-color: var(--md-sys-color-inverse-primary); --forge-switch-handle-on-color: var(--md-sys-color-primary);"></forge-switch>
                                    </md-list-item>
                                    <forge-expansion-panel>
                                        <md-list-item slot="header" style="background-color: var(--md-sys-color-background); border-radius: 5px;">
                                            Music and sound
                                            <div style="display: flex; place-items: center; gap: 10px;" slot="end">
                                                <span class="sf-icon"></span>
                                            </div>
                                        </md-list-item>
                                        <div style="margin-left: 15px; padding: 10px; overflow: hidden;">
                                            <forge-split-view id="musicConfig" auto-close-threshold="120" style="height: 300px;">
                                                <forge-split-view-panel>
                                                  <div>
                                                    <md-list>
                                                        <md-list-item id="candy-fantasia" type="link" href="javascript:void(0)"> <md-icon slot="start">music_note</md-icon> Candy Fantasia </md-list-item>
                                                        <md-list-item id="candy-caravan" type="link" href="javascript:void(0)"> <md-icon slot="start">music_note</md-icon> Candy Caravan </md-list-item>
                                                        <md-list-item id="frosted-brain" type="link" href="javascript:void(0)"> <md-icon slot="start">music_note</md-icon> Frosted Brain </md-list-item>
                                                        <md-list-item id="candy-hour" type="link" href="javascript:void(0)"> <md-icon slot="start">music_note</md-icon> Candy Hour </md-list-item>
                                                        <md-list-item id="pop-the-candy" type="link" href="javascript:void(0)"> <md-icon slot="start">music_note</md-icon> Pop The Candy </md-list-item>
                                                    </md-list>
                                                  </div>
                                                </forge-split-view-panel>
                                                <forge-split-view-panel size="350">
                                                  <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                                    <md-list-item style="background-color: var(--md-sys-color-secondary-container); border-radius: 20px; width: 90%;">
                                                        <md-icon slot="start">music_note</md-icon>
                                                        <div slot="headline" id="songName">?</div>
                                                        <md-icon-button slot="end" id="playSong">
                                                            <md-icon>play_arrow</md-icon>
                                                        </md-icon-button>
                                                    </md-list-item>
                                                    <audio id="musicMain" loop>
                                                        <source id="musicSrc" src="audio/songs/Editor_Song_Theme_Candy_Fantasia.ogg" type="audio/ogg">
                                                    </audio>
                                                    <md-list-item>
                                                        <md-icon-button id="mute" slot="start">
                                                            <md-icon>volume_up</md-icon>
                                                        </md-icon-button>
                                                        <md-slider id="volumeCustomize" min="0" max="1" step="0.01" value="1"></md-slider>
                                                    </md-list-item>
                                                  </div>
                                                </forge-split-view-panel>
                                            </forge-split-view>
                                            <md-divider></md-divider>
                                            <md-list-item>
                                                Enable clicking sound
                                                <forge-switch id="switchClick" icon="none" slot="end" style="--forge-switch-track-on-color: var(--md-sys-color-inverse-primary); --forge-switch-handle-on-color: var(--md-sys-color-primary);"></forge-switch>
                                            </md-list-item>
                                        </div>
                                    </forge-expansion-panel>
                                    <md-list-item onclick="window.open('https://forms.gle/XMkahmBmzxN2HUEN9')"  style="background-color: var(--md-sys-color-background); border-radius: 5px; cursor: pointer;">
                                        Bug report
                                        <span class="sf-icon" slot="end"></span>
                                    </md-list-item>
                                    
                                    <md-list-item style="background-color: var(--md-sys-color-background); border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; border-top-right-radius: 5px; border-top-left-radius: 5px;">
                                        <md-icon slot="start">info</md-icon>
                                        Version 1.9
                                        <forge-button id="checkUpdates" slot="end" style="--forge-button-background: var(--md-sys-color-primary); --forge-button-color: var(--md-sys-color-on-primary);">Check for updates</forge-button>
                                        <forge-button slot="end" style=" --forge-button-color: var(--md-sys-color-primary);">View changelogs</forge-button>
                                    </md-list-item>
                                </md-list>
                                <mdui-snackbar closeable class="updates-notify">You're using the latest version of Level Editor!</mdui-snackbar>
                            </mdui-layout-main>
                        </mdui-layout>
                    </forge-scaffold>
                </forge-dialog>
                <audio id="clickSound" src="audio/ui/Generic_Button_Sound_Effect.wav"></audio>
            </mdui-layout-main>

            <script>
                // Initialize GSAP ScrollTrigger
                gsap.registerPlugin(ScrollTrigger);
            
                // CCGApps logo hover animation
                const ccgappsLogo = document.getElementById('ccgappsLogo');
                const ccgappsText = ccgappsLogo.querySelector('.ccgapps-text');
                const ccgappsImg = ccgappsLogo.querySelector('img');
            
                // Set initial state
                gsap.set(ccgappsText, { x: 0 });
                gsap.set(ccgappsImg, { opacity: 0, x: -10 });
            
                // Create hover animation timeline
                const logoHoverTl = gsap.timeline({ paused: true });
                
                logoHoverTl
                  .to(ccgappsText, {
                    x: 15,
                    duration: 0.3,
                    ease: "power2.out"
                  })
                  .to(ccgappsImg, {
                    opacity: 1,
                    x: 0,
                    duration: 0.3,
                    ease: "power2.out"
                  }, "-=0.2");
            
                // Add hover listeners
                ccgappsLogo.addEventListener('mouseenter', () => {
                  logoHoverTl.play();
                  // Reset gif by reloading it
                  ccgappsImg.src = ccgappsImg.src;
                });
            
                ccgappsLogo.addEventListener('mouseleave', () => {
                  logoHoverTl.reverse();
                });
            
                // Initial animations when page loads
                gsap.from("top-app-bar", {
                    y: -100,
                    opacity: 0,
                    duration: 1,
                    ease: "power3.out"
                });
            </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const backdropDialog = document.getElementById('creditsBackdrop');
                const creditsDialog = document.getElementById('creditsDialog');
                const creditsBtn = document.getElementById('creditsBtn');
                const creditscloseBtn = document.getElementById('creditscloseBtn');

                creditsBtn.addEventListener('click', function() {
                    if (creditsDialog.classList.contains('open')) {
                        // If the dropdown is currently shown, hide it
                        creditsDialog.classList.remove('open');
                        creditsDialog.classList.add('close');
                    } else {
                        // If the dropdown is currently hidden, show it
                        creditsDialog.classList.remove('close'); // Remove hide class to allow showing
                        creditsDialog.classList.add('open');
                    }
                    if (backdropDialog.classList.contains('open')) {
                        // If the dropdown is currently shown, hide it
                        backdropDialog.classList.remove('open');
                        backdropDialog.classList.add('close');
                    } else {
                        // If the dropdown is currently hidden, show it
                        backdropDialog.classList.remove('close'); // Remove hide class to allow showing
                        backdropDialog.classList.add('open');
                    }
                });

                creditscloseBtn.addEventListener('click', function() {
                    if (creditsDialog.classList.contains('open')) {
                        // If the dropdown is currently shown, hide it
                        creditsDialog.classList.remove('open');
                        creditsDialog.classList.add('close');
                    }
                    if (backdropDialog.classList.contains('open')) {
                        backdropDialog.classList.remove('open');
                        backdropDialog.classList.add('close');
                    }
                });
            });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Add event listener for avatar change button
                document.getElementById('changeAvatar').addEventListener('click', function() {
                    if (typeof window.handleAvatarChange === 'function') {
                        window.handleAvatarChange();
                    } else {
                        console.error('handleAvatarChange function is not available');
                    }
                });

                // Function to fetch and display user data
                async function fetchUserData() {
                    try {
                        const user = window.auth.currentUser;
                        
                        if (user) {
                            const userRef = doc(window.db, "users", user.uid);
                            const userDoc = await getDoc(userRef);
                            
                            if (userDoc.exists()) {
                                const userData = userDoc.data();
                                
                                // Update points display
                                const powerUsesElement = document.getElementById('powerUses');
                                if (powerUsesElement) {
                                    powerUsesElement.textContent = userData.points || 0;
                                }
                                
                                // Update streak display
                                const streaksElement = document.getElementById('streaks');
                                if (streaksElement) {
                                    streaksElement.textContent = userData.streak || 0;
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error fetching user data:', error);
                    }
                }

                // Call fetchUserData when auth state changes
                onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        fetchUserData();
                    }
                });
            });
        </script>
    </body>
</html>